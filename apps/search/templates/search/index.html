{% extends 'base.html' %}

{% block title %}Recherche -{% endblock %}

{% block content %}
    <h1>Recherche</h1>
    <h2>Paramètres de la recherche</h2>
        <div class="fieldWrapper form-group">
            <div class="form-field form-control-container form-chips-container">
                <div class="chips-set">
                </div>
                <input placeholder="Enter something here" autofocus autocomplete="off" type="text" class="chip-input chips-input stretchy" />
                <span class="form-control-state"></span>
            </div>
        </div>
    <form method="POST">{% csrf_token %}
        <div class="row">
            <div class="col">
                <div class="fieldWrapper form-group">
                    {{ form.dateMin.label_tag }}
                    <div class="form-control-container has-left-icon">
                        {{ form.dateMin }}
                        <span class="form-control-state"></span>
                        <span class="form-control-icon">
                            <i class="icons-calendar"></i>
                        </span>
                    </div>
                    {% for error in form.dateMin.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="col">
                <div class="fieldWrapper form-group">
                    {{ form.dateMax.label_tag }}
                    <div class="form-control-container has-left-icon">
                        {{ form.dateMax }}
                        <span class="form-control-state"></span>
                        <span class="form-control-icon">
                            <i class="icons-calendar"></i>
                        </span>
                    </div>
                    {% for error in form.dateMax.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="fieldWrapper form-group"> 
                    {{ form.type_juridiction.label_tag }}
                    {{ form.type_juridiction }}
                </div>
            </div>
            <div class="col">
                <div class="fieldWrapper form-group">
                    {{ form.juridiction.label_tag }}
                    <div class="form-control-container has-left-icon">
                        {{ form.juridiction }}
                        <span class="form-control-state"></span>
                        <span class="form-control-icon">
                            <i class="icons-search"></i>
                        </span>
                    </div>
                    {% for error in form.juridiction.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- mot-clés: recherche en tapant les mots-clés -->
        <div class="fieldWrapper form-group">
            {{ form.motsCles_textInput.label_tag }}
            <div class="form-control-container has-left-icon">
                {{ form.motsCles_textInput }}
                <span class="form-control-state"></span>
                <span class="form-control-icon">
                    <i class="icons-search"></i>
                </span>
            </div>
            {% for error in form.motsCles_textInput.errors %}
            <div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>
            {% endfor %}
        </div>
        <!-- mots-clés : recherche avec liste complète non triée -->
        <!--div class="fieldWrapper form-group">
            {{ form.motsCles.label_tag }}
            <div class="select-improved" data-component="select-multiple">
                <div class="select-control">
                    <div class="input-group" data-role="select-toggle">
                        <div class="form-control">
                            <div class="custom-control custom-checkbox">
                                <label data-role="placeholder" class="custom-control-label font-weight-medium">Sélectionnez des mots-clés</label>
                            </div>
                        </div>
                        {{ form.motsCles }}
                        <div class="input-group-append input-group-last">
                            <button class="btn btn-primary btn-only-icon" data-role="btn" type="button" aria-expanded="false" aria-controls="multiselecttoggle">
                                <i class="icons-arrow-down icons-size-x75" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="multiselecttoggle" class="select-menu" data-role="menu">
                        <div class="select-group" data-role="group" data-id="0" role="list">
                            {% for motcle in liste_sans_groupe %}
                                <div class="select-menu-item" role="listitem">
                                    <div class="custom-control custom-checkbox">
                                        <button type="button" data-role="value" data-target="{{ motcle.id }}" role="checkbox" aria-checked="false" class="custom-control-label w-100 text-left font-weight-medium">{{ motcle.nom }}</button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div-->
        <!-- mots-clés : champ par défaut -->
        <!--div class="fieldWrapper form-group">
            {{ form.motsCles }}
        </div-->
        <!-- mot-clés : liste triée par groupe -->
        <div class="fieldWrapper form-group">
            {{ form.motsCles.label_tag }}
            <div class="select-improved" data-component="select-multiple">
                <div class="select-control">
                    <div class="input-group" data-role="select-toggle">
                        <div class="form-control">
                            <div class="custom-control custom-checkbox">
                                <label data-role="placeholder" class="custom-control-label font-weight-medium">Tous les mots-clés</label>
                            </div>
                        </div>
                        {{ form.motsCles }}
                        <div class="input-group-append input-group-last">
                            <button class="btn btn-primary btn-only-icon" data-role="btn" type="button" aria-expanded="false" aria-controls="multiselecttoggle2">
                                <i class="icons-arrow-down icons-size-x75" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="multiselecttoggle2" class="select-menu" data-role="menu" role="list">
                        <div class="select-group" data-role="group" data-id="-1" role="list">
                            {% for motcle in liste_sans_groupe %}
                            <div class="select-menu-item" role="listitem">
                                <div class="custom-control custom-checkbox">
                                    <button type="button" data-role="value" data-target="{{ motcle.id }}" role="checkbox" aria-checked="false" class="custom-control-label w-100 text-left font-weight-medium">{{ motcle.nom}}</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% for groupe in liste %}
                        <div class="select-group" data-role="group" data-id="{{ groupe.id }}" role="listitem">
                            <div class="select-group-head">
                                <div class="custom-control custom-checkbox w-100">
                                    <button type="button" data-role="counter" class="custom-control-label font-weight-bold w-100 text-left text-uppercase">{{ groupe.nom }}</button>
                                </div>     
                            </div>
                            <div class="select-group-content" role="list">
                                {% for motcle in groupe.mots_cles %}
                                <div class="select-menu-item" role="listitem">
                                    <div class="custom-control custom-checkbox">
                                        <button type="button" data-role="value" data-target="{{ motcle.id }}" role="checkbox" aria-checked="false" class="custom-control-label w-100 text-left font-weight-medium">{{ motcle.nom }}</button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div> <br>
        <button type="submit" class="btn btn-primary"><span>Rechercher</span> <i class="icons-search" aria-hidden="true"></i></button>
        <!--button type="submit" class="btn btn-outline-primary" disabled><span>Prévoir</span> <i class="icons-share" aria-hidden="true"></i></button-->
    </form>
    <style>input:focus-visible{outline:none;}</style>
    <script>
        var input = document.querySelector(".chip-input");
        var chips = document.querySelector(".chips-set");

        document.querySelector(".form-field")
        .addEventListener('click',() => {
            //input.style.display = 'block';
            input.focus();
        });
        
        input.addEventListener('blur',()=>{
            //input.style.display = 'none';
        });

        input.addEventListener('keypress', function(event) {
            if(event.which === 13){
                chips.appendChild(function () {
                    var _chip = document.createElement('div');
                    _chip.classList.add('chips-group');
                    _chip.classList.add('chip');
                    //_chip.addEventListener('click', chipClickHandler);
                    _chip.append(
                        (function () {
                            var _chip_text = document.createElement('span');
                            _chip_text.classList.add('chips');
                            _chip_text.classList.add('chips-label');
                            _chip_text.innerHTML = input.value;
                            return _chip_text;
                        })(),
                        (function () {
                            var _chip_button = document.createElement('button');
                            _chip_button.classList.add('chips');
                            _chip_button.classList.add('chips-btn');
                            _chip_button.classList.add('chips-only-icon');
                            _chip_button.innerHTML = '<i class="icons-close" aria-hidden="true"></i>';
                            _chip_button.addEventListener('click', chipClickHandler);
                            return _chip_button;
                        })()
                    );
                    return _chip;
                }());
                input.value = '';
            }
        });
        
        function chipClickHandler(event){
            chips.removeChild(event.currentTarget.parentNode);
        }
    </script>
{% endblock %}
