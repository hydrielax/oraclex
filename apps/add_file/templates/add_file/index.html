{% extends 'base.html' %}

{% block title %}Ajout de fichiers -{% endblock %}

{% block content %}
    <style>
        .btn-light-outline {
            background-color: var(--white);
            color: var(--dark);
            border-color: #d9d9d9;
        }
        .mw-20 {
            max-width: 20vw
        }
    </style>

    <h1>
        Ajout de fichiers
    </h1>


    <h2>
        Envoyer des jugements à analyser
    </h2>

    <form class="mb-4" method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        {{ selection.fichiers }}
        <button class="btn btn-light mb-1" type="button"
            onclick="document.getElementById('id_fichiers').click();">
        Fichiers &nbsp;<i class="icons-document"></i>
        </button>

        {{ selection.dossier }}
        <button class="btn btn-light mb-1" type="button"
            onclick="document.getElementById('id_dossier').click();">
        Dossier &nbsp;<i class="icons-file"></i>
        </button>

        <span id="cancel-validate"></span>
        <p class="mt-1" id="file_count"></p>
        <script>
        function updateInfo() {
            let buttons = "<button class='btn btn-light btn-light-outline mb-1' type='button' onclick='location.reload();'>Annuler</button> ";
            buttons += "<button class='btn btn-outline-success mb-1' type='submit'>Valider</button>";
            document.getElementById("cancel-validate").innerHTML = buttons;
            const nb_file = document.getElementById("id_fichiers").files.length
            const nb_folder = document.getElementById("id_dossier").files.length
            const file_number = `${nb_file + nb_folder} fichiers sélectionnés`;
            document.getElementById("file_count").innerHTML = file_number;
        }
        </script>
    </form>


    <h2>
        Historique des jugements envoyés
    </h2>
    {% if tableau %}
    <table class="table" id="tableau">
        <script>
            var s = -1;
            function display_table(sort_field) {
                var table = {{ tableau }};
                var html = "<thead><tr>";
                for (const [field, name] of Object.entries(table[0])) {
                    html += `<th><a class="d-flex" href="javascript:display_table('${field}');">`;
                    html += `<span class='text-truncate mw-20'>${name}&nbsp;</span>&nbsp;`
                    html += `<i class="dropdown-toggle${s>0?'':' icons-flip-vertical'}${field==sort_field?'':' invisible'}">`;
                    html += "</i></a></th>";
                } html += "</tr></thead>";
                table.shift();
                table.sort((r1, r2) => r1[sort_field].toLowerCase() > r2[sort_field].toLowerCase() ? s : -s);
                s = -s;
                html += "<tbody>";
                for(const row of table) {
                    html += "<tr>";
                    for (const value of Object.values(row)) {
                        html += `<td class='text-truncate mw-20'>${value}</td>`;
                    } html += "</tr>";
                } html += "</tbody>";
                document.getElementById("tableau").innerHTML = html;
            }
        display_table('date');
        </script>
    </table>
    {% else %}
        Aucun jugement en attente de validation
    {% endif %}
{% endblock %}